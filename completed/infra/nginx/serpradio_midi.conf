# MIDI file serving configuration for SerpRadio
# Serves MIDI files from widget/midi/ directory

location /midi/ {
    alias /opt/serpradio/widget/midi/;
    
    # Set proper MIME type for MIDI files
    location ~* \.(mid|midi)$ {
        add_header Content-Type application/x-midi;
        add_header Cache-Control "public, max-age=86400"; # Cache for 24 hours
        expires 1d;
    }
    
    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    
    # CORS headers for cross-origin requests
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, OPTIONS";
    add_header Access-Control-Allow-Headers "Content-Type";
    
    # Handle preflight requests
    if ($request_method = OPTIONS) {
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, OPTIONS";
        add_header Access-Control-Allow-Headers "Content-Type";
        add_header Content-Length 0;
        add_header Content-Type text/plain;
        return 200;
    }
} 